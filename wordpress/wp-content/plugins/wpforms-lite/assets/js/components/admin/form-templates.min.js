var WPFormsFormTemplates=window.WPFormsFormTemplates||function(e,t,v){const w={},g={init(){v(g.ready),v(t).on("load",function(){"function"==typeof v.ready.then?v.ready.then(g.load):g.load()})},ready(){g.setup(),g.events()},load(){g.showUpgradeBanner()},setup(){w.templateList=new List("wpforms-setup-templates-list",{valueNames:["wpforms-template-name","wpforms-template-desc",{name:"fields",attr:"data-fields"},{name:"slug",attr:"data-slug"},{name:"categories",attr:"data-categories"},{name:"subcategories",attr:"data-subcategories"},{name:"has-access",attr:"data-has-access"},{name:"favorite",attr:"data-favorite"}]})},events(){v(e).on("click","#wpforms-setup-templates-list .wpforms-template-favorite i",g.selectFavorite)},selectFavorite(){const e=v(this),t=e.hasClass("fa-heart-o"),a=e.closest(".wpforms-template-favorite"),s=e.closest(".wpforms-template"),o=s.find(".wpforms-template-name"),r=s.find(".wpforms-template-select").data("slug"),l=v(".wpforms-setup-templates-categories").find("[data-category='favorites']"),n=l.find("span"),i={action:"wpforms_templates_favorite",slug:r,favorite:t,nonce:wpforms_form_templates.nonce};let m=parseInt(n.html(),10);function p(){d.favorite=!1,m-=1,f.values(d),u(),o.data("data-favorite",0),n.html(m),g.maybeHideFavoritesCategory()}function c(){d.favorite=!0,m+=1,f.values(d),u(),o.data("data-favorite",1),n.html(m),g.maybeHideFavoritesCategory()}const f=w.templateList.get("slug",r)[0],d=f.values(),u=function(){a.find(".fa-heart-o").toggleClass("wpforms-hidden",d.favorite),a.find(".fa-heart").toggleClass("wpforms-hidden",!d.favorite)};v.post(wpforms_form_templates.ajaxurl,i,function(e){e.success||(t?p:c)()}),(t?c:p)()},maybeHideFavoritesCategory(){var e=v(".wpforms-setup-templates-categories"),t=e.find("[data-category='favorites']"),a=parseInt(t.find("span").html(),10);t.toggleClass("wpforms-hidden",!a),t.hasClass("active")&&(a?t:e.find("[data-category='all']")).trigger("click")},searchTemplate(){g.performSearch(v(this).val()),g.showUpgradeBanner()},performSearch(e){e=w.templateList.search(e,["name"],function(a){for(let e=0,t=w.templateList.items.length;e<t;e++){var s=w.templateList.items[e].values(),o=s["wpforms-template-name"].toLowerCase(),r=s["wpforms-template-desc"].toLowerCase(),s=s.fields.toLowerCase(),l=new RegExp(a);w.templateList.items[e].found=l.test(o)||l.test(r)||l.test(s)}});v(".wpforms-templates-no-results").toggle(!e.length)},selectSubCategory(e){e.preventDefault();var e=v(this),t=e.closest("ul").find(".active");const a=e.data("subcategory"),s=e.parents("li").data("category");var o=v("#wpforms-setup-template-search").val();t.removeClass("active"),e.addClass("active"),w.templateList.filter(function(e){return"all"===s||-1<e.values().categories.split(",").indexOf(s)&&-1<e.values().subcategories.split(",").indexOf(a)}),""!==o&&g.performSearch(o),g.showUpgradeBanner()},selectCategory(e){e.preventDefault();const t=v(this).parent(),a=t.closest("ul").find(".active"),s=t.data("category"),o=v("#wpforms-setup-template-search").val();a.removeClass("active"),t.addClass("active"),w.templateList.filter(function(e){return"available"===s?e.values()["has-access"]:"favorites"===s?e.values().favorite:"all"===s||-1<e.values().categories.split(",").indexOf(s)}),""!==o&&g.performSearch(o),g.showUpgradeBanner()},selectTemplateCancel(){var e=v("#wpforms-setup-templates-list").find(".wpforms-template.active"),t=e.find(".wpforms-template-select");e.removeClass("active"),t.html(t.data("labelOriginal"))},showUpgradeBanner(){var e,t;v("#tmpl-wpforms-templates-upgrade-banner").length&&(e=wp.template("wpforms-templates-upgrade-banner"))&&(5<(t=v("#wpforms-setup-templates-list .wpforms-template")).length?t.eq(5):t.last()).after(e())},selectTemplateProcess(e,t,a,s){a.data("addons")?g.addonsModal(e,t,a,s):s(e,t)},addonsModal(e,t,a,s){var o=a.data("template-name-raw"),r=a.data("addons-names"),a=a.data("addons").split(",");let l=1<a.length?wpforms_form_templates.template_addons_prompt:wpforms_form_templates.template_addon_prompt;l=l.replace(/%template%/g,o).replace(/%addons%/g,r),a.length&&(wpforms_form_templates.can_install_addons?g.userCanInstallAddonsModal(e,t,a,l,s):g.userCannotInstallAddonsModal(l))},userCanInstallAddonsModal(e,t,a,s,o){v.confirm({title:wpforms_form_templates.heads_up,content:s,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_form_templates.install_confirm,btnClass:"btn-confirm",keys:["enter"],action(){return this.$$confirm.prop("disabled",!0).html('<i class="wpforms-loading-spinner wpforms-loading-white wpforms-loading-inline"></i>'+wpforms_form_templates.activating),this.$$cancel.prop("disabled",!0),g.installActivateAddons(a,this,e,t,o),!1}},cancel:{text:wpforms_form_templates.cancel,action(){WPFormsFormTemplates.selectTemplateCancel()}}}})},userCannotInstallAddonsModal(e){v.alert({title:wpforms_form_templates.heads_up,content:e,icon:"fa fa-exclamation-circle",type:"orange",buttons:{ok:{text:wpforms_form_templates.ok,btnClass:"btn-confirm",keys:["enter"],action(){WPFormsFormTemplates.selectTemplateCancel()}}}})},installActivateAddons(e,t,a,s,o){const r=[],l=[];let n=!1;e.forEach(function(t){n="function"!=typeof n.done?g.installActivateAddonAjax(t):n.done(function(e){return r.push(e),g.installActivateAddonAjax(t)}).fail(function(e){l.push(e)})}),n.done(function(e){r.push(e)}).fail(function(e){l.push(e)}).always(function(){t.close(),0<r.length&&wpf.listPluck(r,"success").every(Boolean)&&0===l.length?o(a,s):g.installActivateAddonsError(a,s,o)})},installActivateAddonsError(e,t,a){v.confirm({title:wpforms_form_templates.heads_up,content:wpforms_form_templates.template_addons_error,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_form_templates.use_template,btnClass:"btn-confirm",keys:["enter"],action(){a(e,t)}},cancel:{text:wpforms_form_templates.cancel,action(){g.selectTemplateCancel()}}}})},installActivateAddonAjax(e){var t=wpforms_addons[e],a=new v.Deferred;return!t||["activate","install"].indexOf(t.action)<0?(a.resolve(!1),a.promise()):v.post(wpforms_form_templates.ajaxurl,{action:"wpforms_"+t.action+"_addon",nonce:wpforms_form_templates.admin_nonce,plugin:"activate"===t.action?e+"/"+e+".php":t.url})}};return g}(document,window,jQuery);WPFormsFormTemplates.init();